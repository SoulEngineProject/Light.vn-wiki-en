---
title: 10. 最適化
description: 
published: true
date: 2025-07-17T20:44:42.217Z
tags: 
editor: markdown
dateCreated: 2025-07-17T20:44:42.217Z
---

# スクリプトの最適化

作品スクリプトをより楽に、効率よく書くためのTIPを掲載

## コマンド「文字自動待機」
- 初心者の場合、よく全てのシナリオ行の最後に「\w」をいれる傾向がある。
- `文字自動待機`を使用すると、いちいち「\w」をいれる必要がなくなる。

## 立ち絵登場の最適化

初心者の場合、よく以下のように立ち絵を登場させている：
```
絵0 alice2 scg2.png 240 230 79
拡大 alice2 75%
イン alice2 300
```
ただ、こうする場合、例えばエディターの1行をクリックすると、立ち絵がみえず、2行の拡大などもあって座標指定が面倒だったりする。 
  
上のスクリプトを以下にかえると：  
```
絵0 alice2 scg2.png 240 230 79 | 拡大 alice2 75% | イン alice2 300
```
一行に登場コマンドを全部纏めることで、座標指定もしやすくなる。  
（`|`で複数のコマンドを一行に纏められる）

## 演出コマンドは複数の個体を対象にできる

初心者の場合、よく
```
アウト alice1
アウト alice2
アウト alice3
アウト alice4
```
など、複数行にわたって、同じ演出を複数の個体にあてがち。  
これは、以下に変更可能：  
```
アウト alice1, alice2, alice3, alice4 800
```
一行に纏めることで、後になって時間などの他入力を変えたくなっても、  
一か所のみ修正することで済む。

## 立ち絵の画像を他画像に変更する

初心者の場合、たまに
```
絵0 alice2 scg2.png 240 230 79
拡大 alice2 75%
イン alice2 300

絵 alice2 scg2.png 240 230 79
拡大 alice2 75%
```
等、例えばalice2の画像を変えたい場合、`絵`コマンドをまた使用することを見る。
この方法の場合、拡大コマンドを繰り返してまた使用するなどの面倒ごとも発生する。
  
`画像`コマンドを使用すれば、わざわざ`絵`コマンドを使用する必要も、また拡大コマンドをかける必要もなく。トランジション時間などもかけられ、より滑らかな画像変換が可能になる。

## マクロの最適化

マクロの場合、単純に考えると「Aという文字ををBという文字に変換」させる機能です。（例：ワードプログラムなどでよくあるctrl + h での文字置換）
なので、Light.vnのシナリオ行、コマンド行関係なく両方に反映可能なしくみになっておりまして、柔軟でもあり、逆に言えば製作側の予想を超えた変な場所にまで反映され、結果的に予想外のエラーの原因としても頻繁に作用します。

例：<img width="683" height="512" alt="image" src="https://github.com/user-attachments/assets/8e8bf51d-7c2f-40cf-a063-f4a377aad9b0" />
（画像素材として、「skip_off」というものを読み込もうとしている：何かおかしい。「skip_off」は恐らく栞であるが、栞が何故か画像素材として認識されているー＞多分マクロ問題）

マクロを柔軟に、また安全に使用するには、
以下の方針での活用をお勧めします。
経験上、マクロをコマンドの一種として活用する方を多く見ます。
この場合、

A.`コマンドマクロ`を使う
- 正規表現の使用ができない反面、逆にそうだから一番動作が安定。
- 例：
```
~マクロ 文字窓下段 “スクリプト system\textbox.txt default”
```
を次に変更：
```
~コマンドマクロ 文字窓下段 “スクリプト system\textbox.txt default”
```
(以下、正規表現の使用が必要なマクロを使う場合のアドバイス）

B. マクロの先に`~`をつける
- 例：
```
~マクロ 文字窓下段 “スクリプト system\textbox.txt default”
```
- 危険：
  - 例えば、`文字窓下段`という文字がスクリプトの途中に出てきても勝手に`~スクリプト system\textbox.txt default`に変換される
- 改善：
```
~マクロ ~文字窓下段 “~スクリプト system\textbox.txt default”
```
  - Light.vnは行頭に`~`が来ると、それ以降の行をコマンドとして認識するようになります。
  - というわけで、コマンドとして活用したいマクロの場合も、先頭に必ず`~`が来るように設定しておけば、より安全な使用が出来ます。

C. マクロの先に`^`をつける
- 例：
```
~マクロ ^~文字窓下段 “^~スクリプト system\textbox.txt default”
```
  - (A)に続いて、Light.vn のマクロはすべて`正規表現`というもので、その内`^`という記号は、行頭の意味を持ちます。
  - というわけで、このような設定にすると、`~文字窓下段`が行頭に置かれている際にのみ変換させるので、シナリオ行途中でなど変な箇所での変換をこれで確実に回避できます。
    - -> エラーに繋がらない、万歳！

